{{- $pageData := .Page -}}
{{- $siteData := .Site -}}
{{- $pageUrl := printf "https://www.gooddata.com%s" $pageData.RelPermalink -}}
{{- $breadcrumbs := partial "parseUrlBreadcrumbs.html" $pageUrl -}}

{{ partial "structureddata/structureddata.common-top.html" }}
{
    "@type": "WebPage",
    "@id": "https://www.gooddata.com{{ $pageData.RelPermalink }}#webpage",
    "url": "https://www.gooddata.com{{ $pageData.RelPermalink }}",
    "name": "{{ $pageData.Params.title }} | GoodData Cloud Documentation",
    "description": {{ if $pageData.Params.description }}{{ $pageData.Params.description | jsonify }}{{ else }}{{ $pageData.Summary | jsonify }}{{ end }},
    "isPartOf": {
    "@id": "https://www.gooddata.com#website"
    },
    "mainEntityOfPage": {
    "@id": "https://www.gooddata.com{{ $pageData.RelPermalink }}#techarticle"
    },
    "breadcrumb": {
    "@id": "https://www.gooddata.com{{ $pageData.RelPermalink }}#breadcrumb"
    }
},
{
    "@type": "BreadcrumbList",
    "@id": "https://www.gooddata.com{{ $pageData.RelPermalink }}#breadcrumb",
    "itemListElement": [
    {{- range $index, $breadcrumb := $breadcrumbs -}}
    {{- $position := add $index 1 -}}
    {{- $pathSegments := split $breadcrumb "/" -}}
    {{- $lastSegment := index $pathSegments (sub (len $pathSegments) 2) -}}
    {{- $name := cond (eq $position 1) "Documentation" (cond (eq $lastSegment "cloud") "GoodData Cloud" $lastSegment) -}}
        {{- if gt $index 0 }},{{ end }}
        {
            "@type": "ListItem",
            "position": {{ $position }},
            "name": {{ humanize $name | jsonify }},
            "item": {{ $breadcrumb | jsonify }}
        }
    {{- end }}
    ]
},
{
    "@type": "TechArticle",
    "@id": "https://www.gooddata.com{{ $pageData.RelPermalink }}#techarticle",
    "mainEntityOfPage": {
    "@id": "https://www.gooddata.com{{ $pageData.RelPermalink }}#webpage",
    "@type": "WebPage"
    },
    "headline": {{ $pageData.Params.title | jsonify }},
    "description": {{ if $pageData.Params.description }}{{ $pageData.Params.description | jsonify }}{{ else }}{{ $pageData.Summary | jsonify }}{{ end }},
    "image": "https://www.gooddata.com/docs/og/OG_cloud_doc.webp",
    "author": {
    "@id": "https://www.gooddata.com#organization"
    },
    "publisher": {
    "@id": "https://www.gooddata.com#organization"
    },
    "dateModified": {{ $pageData.Params.lastmod | jsonify }},
    "articleSection": {{ $pageData.Parent.Title | jsonify }}
}
{{ partial "structureddata/structureddata.common-bottom.html" }}
